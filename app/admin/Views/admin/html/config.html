<html lang="zh-CN">
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="yes" name="mobile-web-app-capable">
<meta content="black-translucent" name="apple-mobile-web-app-status-bar-style">
<meta content="webkit" name="renderer">
<meta content="#F55D54" name="theme-color">
<title>{$GLOBALS.title}-{$GLOBALS.version}-{$GLOBALS.subtitle}</title>
<link rel="stylesheet" href="/static/layui/css/layui.css">
<link rel="stylesheet" media="screen" href="/static/css/main.css">
<link rel="stylesheet" href="/static/font-awesome-4.7.0/css/font-awesome.min.css">
</head>
<body class="guodong-body">
<style>
.water-position .layui-table td, .layui-table th {
    position: relative;
    padding: 0;
	margin:0;
}
.water-position .layui-form-radio {
    margin:0;
    padding:14px 6px;
    cursor: pointer;
    font-size: 0;
	display:flex;
	justify-content:center;
}
.water-position .layui-table tbody tr:hover{
    background-color: transparent;
}
.water-position .layui-table tbody tr td:hover{
        background-color: #f2f2f2;
}
.water-position .layui-table tbody tr td .layui-form-radioed{
        background-color: #f2f2f2;
}
.water-position .layui-form-radio>i {
    margin-right: 0;
    font-size: 22px;
}

.layui-upload-list dl {
    width: 92px;
    height: 92px;
    margin: 0 10px 10px 0;
	position:relative;
}
.layui-upload-list dl  img{
    width: 92px;
    height: 92px;
}
.layui-upload-list dl dd{
    position:absolute;
	top:0;
	right:0;
	font-size:14px;
	color:#f00;
	cursor:pointer;
}
.layui-colorpicker {
    padding: 3px !important;
	line-height:18px !important;
}
.layui-textarea {
    min-height: 100px;
    height: auto;
    line-height: 14px;
    padding: 6px 10px;
    resize: vertical;
}
</style>
{include:head.html}
<div class="layui-fluid">
<div class="layui-row">

	<div class="layui-tab layui-tab-brief layui-card" lay-filter="tab">
	  <ul class="layui-tab-title">
	    <li class="layui-this" lay-id="t1">基本配置</li>
	    <li lay-id="t2">图片水印</li>
	    <li lay-id="t3">安全配置</li>
	    <li lay-id="t4">URL规则</li>
	  </ul>
		  <div class="layui-tab-content">
		  	   <div class="layui-tab-item layui-show">
		  	   	   <form action="{url:/config/edit}" id='basic' method="post" class="layui-form">
			  	   	    <div class="layui-form-item">
		                     <label class="layui-form-label">网站状态</label>
		                     <div class="layui-input-inline">
								<input type="radio" name="web_status" value="1" checked="checked" title="开启">
		                     	<input type="radio" name="web_status" value="0" title="关闭">

		                     </div>
		                </div>
		                
			  	   	     <div class="layui-form-item">
		                     <label class="layui-form-label">关站提示</label>
		                     <div class="layui-input-block">
		                     	<textarea name="close_tip" placeholder="关站提示" class="layui-textarea"></textarea>
		                     </div> 
		                </div>

		                <div class="layui-form-item">
		                     <label class="layui-form-label">缓存</label>
		                     <div class="layui-input-inline">
		                     	<input type="radio" name="cached" value="1" title="启用">
								<input type="radio" name="cached" value="0" checked="checked" title="禁用">
		                     </div>
							 <div class="layui-form-mid layui-word-aux">开启缓存，将降低服务器性能消耗，增加负载能力</div>
		                </div>
		                
		                <div class="layui-form-item">
		                     <label class="layui-form-label">缓存时间(秒)</label>
		                     <div class="layui-input-inline">
		                     	<input type="text" name="cache_time" value="900" placeholder="缓存时间（秒）" class="layui-input">
		                     </div>
		                </div>
		                
		                <div class="layui-form-item">
		                     <label class="layui-form-label">Gzip</label>
		                     <div class="layui-input-inline">
		                     	<input type="radio" name="gzip" value="1" title="启用">
								<input type="radio" name="gzip" value="0" checked="checked" title="禁用">
		                     </div>
							 <div class="layui-form-mid layui-word-aux">压缩传输</div>
		                </div>

		                <div class="layui-form-item">
		                     <label class="layui-form-label">分页条数</label>
		                     <div class="layui-input-inline">
		                     	<input type="text" name="pagenum" value="5" placeholder="列表分页数字条显示数量" class="layui-input">
		                     </div>
		                     <div class="layui-form-mid layui-word-aux">列表分页数字条显示数量，建议使用寄数值，当前页会显示在中间位置。</div>
		                </div>
		                
		                <div class="layui-form-item">
		                     <label class="layui-form-label">内链替换</label>
		                     <div class="layui-input-inline">
		                     	<input type="text" name="tag_times" value="3" placeholder="默认3次" class="layui-input">
		                     </div>
		                     <div class="layui-form-mid layui-word-aux">发布内容时内链替换次数</div>
		                </div>
		                <div class="layui-form-item">
		                     <label class="layui-form-label">敏感词过滤</label>
		                     <div class="layui-input-block">
		                     	<textarea name="forbid_words" placeholder="多个敏感词之间逗号隔开" class="layui-textarea"></textarea>
		                     	<div class="layui-form-mid layui-word-aux">多个敏感词半角用逗号隔开</div>
		                     </div>
		                     
		                </div>               
						<div class="layui-form-item">
							 <div class="layui-input-block">
								<button lay-submit lay-filter="submit" class="layui-btn">立即提交</button>
								<button type="reset" class="layui-btn layui-btn-primary">重置</button>
							 </div>
						</div>
	              </form>
		  	   </div>
		  	   
		  	    <div class="layui-tab-item">
		  	   	  <form action="{url:/config/edit}" method="post" id='water-set' class="layui-form">
		  	   		<div class="layui-form-item">
	                     <label class="layui-form-label">状态</label>
	                     <div class="layui-input-inline">
	                     	<input type="radio" name="water_status" value="1" title="启用">
							<input type="radio" name="water_status" value="0" checked="checked" title="禁用">
	                     </div>
						<div class="layui-form-mid layui-word-aux">水印功能只在内容页上传图片有效</div>
	                </div>
	                
	                <div class="layui-form-item">
	                      <label class="layui-form-label">水印文字</label>
	                     <div class="layui-input-inline">
	                     	<input type="text" name="water_text" value="JellyCMS" placeholder="水印文字，如：JellyCMS" class="layui-input">
	                     </div>
	                </div>
					
					<div class="layui-form-item">
	                     <label class="layui-form-label">文字字体</label>
	                     <div class="layui-input-inline">
	                     	<input type="text" name="water_font" id="water-font-input" value="" placeholder="请上传水印文字字体" class="layui-input">
	                     </div>
							<button type="button" class="layui-btn" id="water-font">
							  <i class="layui-icon">&#xe67c;</i>上传字体
							</button>
	                </div>
	                
	                <div class="layui-form-item">
	                      <label class="layui-form-label">文字大小</label>
	                     <div class="layui-input-inline">
	                     	<input type="text" name="water_text_size" value="20" placeholder="水印文字大小，如：20" class="layui-input">
	                     </div>
	                </div>
	                
	                <div class="layui-form-item">
	                      <label class="layui-form-label">文字颜色</label>
	                     <div class="layui-input-inline">
	                     	<input type="text" name="water_color" id="water-color-input" placeholder="文字颜色" class="layui-input">
	                     </div>
						 <span id="water-color"></span>
	                </div>
	                
	                <div class="layui-form-item">
	                     <label class="layui-form-label">水印图片</label>
	                     <div class="layui-input-inline">
	                     	<input type="text" name="water_pic" id="water_pic" value="" placeholder="水印图片，优先文字水印" class="layui-input">
							<div class="layui-form-mid layui-word-aux">优先文字水印,如需使用图片水印请将"水印文字"清空</div>
						</div>
							<button type="button" class="layui-btn" id="water-pic">
							  <i class="layui-icon">&#xe67c;</i>上传图片
							</button>
	                </div>
	                
	                <div class="layui-form-item water-position">
						<label class="layui-form-label">水印位置</label>
						<div class="layui-input-inline">
							<table class="layui-table" lay-size="sm">
								<tr>
									<td><input type="radio" name="position" value="1"></td>
									<td><input type="radio" name="position" value="2"></td>
									<td><input type="radio" name="position" value="3"></td>
								</tr>
								<tr>
									<td><input type="radio" name="position" value="4"></td>
									<td><input type="radio" name="position" value="5"></td>
									<td><input type="radio" name="position" value="6"></td>
								</tr>
								<tr>
									<td><input type="radio" name="position" value="7"></td>
									<td><input type="radio" name="position" value="8"></td>
									<td><input type="radio" name="position" value="9"></td>
								</tr>
							</table>
	                     </div>
	                </div>

					<div class="layui-form-item">
						 <div class="layui-input-block">
							<button lay-submit lay-filter="submit" class="layui-btn">立即提交</button>
							<button type="reset" class="layui-btn layui-btn-primary">重置</button>
						 </div>
					</div>
				 </form>
		  	   </div> 
		  	   
		  	    <div class="layui-tab-item">
		  	   	   <form action="{url:/config/edit}" method="post" id="safe-config" class="layui-form">
		                <div class="layui-form-item">
		                     <label class="layui-form-label">后台验证码</label>
		                     <div class="layui-input-inline">
		                     	<input type="radio" name="admin_check_code" value="1" checked="checked" title="启用">
								<input type="radio" name="admin_check_code" value="0" title="禁用">
		                     </div>
		                </div>
		                
		                <div class="layui-form-item">
		                     <label class="layui-form-label">留言功能</label>
		                     <div class="layui-input-inline">
		                     	<input type="radio" name="message_status" value="1" checked="checked" title="启用">
								<input type="radio" name="message_status" value="0" title="禁用">
		                     </div>
		                </div>
		                
		                <div class="layui-form-item">
		                     <label class="layui-form-label">留言验证码</label>
		                     <div class="layui-input-inline">
		                     	<input type="radio" name="message_ver_code" value="1" checked="checked" title="启用">
								<input type="radio" name="message_ver_code" value="0" title="禁用">
		                     </div>
		                </div>
		                
		                <div class="layui-form-item">
		                     <label class="layui-form-label">留言审核</label>
		                     <div class="layui-input-inline">
		                     	<input type="radio" name="message_verify" value="1" checked="checked" title="启用">
								<input type="radio" name="message_verify" value="0" title="禁用">
		                     </div>
		                </div>
		                
		                <div class="layui-form-item">
		                     <label class="layui-form-label">表单功能</label>
		                     <div class="layui-input-inline">
		                     	<input type="radio" name="form_status" value="1" checked="checked" title="启用">
								<input type="radio" name="form_status" value="0" title="禁用">
		                     </div>
		                </div>
		                
		                <div class="layui-form-item">
		                     <label class="layui-form-label">表单验证码</label>
		                     <div class="layui-input-inline">
		                     	<input type="radio" name="form_ver_code" value="1" title="启用">
								<input type="radio" name="form_ver_code" value="0" checked="checked" title="禁用">
		                     </div>
		                </div>
		                
		                <div class="layui-form-item">
		                     <label class="layui-form-label">登录保护</label>
		                     <div class="layui-input-inline">
								<input type="text" name="lock_count" value="5" placeholder="登录失败几次后锁定IP，默认5次" class="layui-input">
		                     </div>
		                     <div class="layui-form-mid layui-word-aux">次</div>
		                </div>
		                
		                <div class="layui-form-item">
		                   <label class="layui-form-label">锁定时间</label>
		                   <div class="layui-input-inline">
		                  		<input type="text" name="lock_time" value="900" placeholder="登录异常锁定时间，默认为900秒" class="layui-input">
		                   </div>
		                   <div class="layui-form-mid layui-word-aux">秒</div>
			            </div>

			           <div class="layui-form-item">
		                     <label class="layui-form-label">IP黑名单</label>
		                     <div class="layui-input-block">
		                     	<textarea name="blackip" placeholder="多个IP以半角用逗号隔开" class="layui-textarea"></textarea>
		                     </div> 
		                </div>
		                
		                <div class="layui-form-item">
		                     <label class="layui-form-label">IP白名单</label>
		                     <div class="layui-input-block">
		                     	<textarea name="whiteip" placeholder="多个IP以半角用逗号隔开" class="layui-textarea"></textarea>
		                     </div> 
		                </div>
		                
						<div class="layui-form-item">
							 <div class="layui-input-block">
								<button lay-submit lay-filter="submit" class="layui-btn">立即提交</button>
								<button type="reset" class="layui-btn layui-btn-primary">重置</button>
							 </div>
						</div>
	              </form>
		  	   </div>
		  	   
		  	   <div class="layui-tab-item">
		  	   	   <form action="{url:/config/edit}" method="post" id="url-config" class="layui-form">
						<div class="layui-form-item">
							 <label class="layui-form-label">地址模式</label>
							 <div class="layui-input-block">
								<div>
									<input type="radio" name="url_rule" value="1" title="普通模式，如：/index.php/news/1.html">
								</div>
								<div>
									<input type="radio" name="url_rule" value="2" title="伪静态模式，如：/news/1.html">
								</div>
								<div>
									<input type="radio" name="url_rule" value="3" title="兼容模式，如：/?news/1.html">
								</div>
							 </div>
						</div>

						<div class="layui-form-item">
							 <label class="layui-form-label">URL后缀</label>
							 <div class="layui-input-block">
								<input type="radio" name="url_suffix" value="1" title="启用">
								<input type="radio" name="url_suffix" value="0" checked="checked" title="禁用">
							 </div>
						</div>
							
						<div class="layui-form-item">
							 <div class="layui-input-block">
								<button lay-submit lay-filter="submit" class="layui-btn">立即提交</button>
								<button type="reset" class="layui-btn layui-btn-primary">重置</button>
							 </div>
						</div>
					</form>
		  	   </div>
		  </div>
	 </div>
</div>
</div>
	
<script src="/static/layui/layui.all.js"></script>
<script src="/static/js/jquery-3.4.1.min.js"></script>
<script src="/static/js/loadData.js"></script>
<script>
!function(){
	var layer = layui.layer,
	form = layui.form;
	var element = layui.element;
	var $ = layui.jquery;
	var upload = layui.upload;
	var colorpicker = layui.colorpicker;
	   $.ajax({
			url:"{url:/config/getdata}", //请求的服务端地址
			type:"post",
			dataType:"json",
			success:function(data){
				if(data.code == 1){
					loadData(data.data, 'form');
					form.render();
					$('.layui-colorpicker-trigger-span').css('background',$('#water-color-input').val());
				}
				else{
					//layer.msg(data.msg)
				}  
			},
			error:function(){
			  //layer.msg('error'); //错误处理
			}
		});

		//执行实例
		var uploadInst = upload.render({
			elem: '#water-pic',
			url: '{url:/upload/uploadFile}',
			before: function(obj){
			  //预读本地文件示例，不支持ie8
			  obj.preview(function(index, file, result){
				$('.preview img').attr('src', result); //图片链接（base64）
			  });
			},
			done: function(res){
				//上传完毕回调
				$('input[name="water_pic"]').val(res.data.path);
				layer.msg('上传成功')
			},
			error: function(){
				//请求异常回调
			}
		})
	
		//执行实例
		var uploadInst = upload.render({
			elem: '#water-font',
			url: '{url:/upload/uploadFile}',
			accept:'file',
			done: function(res){
				//上传完毕回调
				$('input[name="water_font"]').val(res.data.path);
				layer.msg('上传成功')
			},
			error: function(){
				//请求异常回调
			}
		})
	
		colorpicker.render({
			elem: '#water-color'
			,predefine: true // 开启预定义颜色
			,color: $('input[name="water_color"]').val()
			,alpha: true
			,format: 'rgb'
			,done: function(color){
			  $('input[name="water_color"]').val(color);
			  form.render();
			}
		});	
	form.render();
	form.on('submit(submit)', function(data){
	   var url = $(this).parents('form').prop('action');
	   $.ajax({
			url:url, //请求的服务端地址
			data:data.field,
			type:"post",
			dataType:"json",
			success:function(data){
				if(data.code == 1){
					layer.msg(data.msg)
				}
				else{
					layer.msg(data.msg)
				}  
			},
			error:function(){
			  layer.msg('error'); //错误处理
			}
		});
	   return false;
	});
}();
</script>
</body>
</html>